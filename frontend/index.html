<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-lang="title">物理治療平台 (測試版)</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts (Optional, for a more modern look) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>

    <!-- Header -->
    <header class="sticky-top">
        <nav class="navbar navbar-expand-lg navbar-dark navbar-transparent shadow-sm">
            <div class="container">
                <a class="navbar-brand fw-bold text-primary" href="#" data-section="home" data-lang="title">物理治療平台</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#main-nav-collapse" aria-controls="main-nav-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="main-nav-collapse">
                    <ul id="main-nav" class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item" data-role='["user", "doctor", "admin"]'><a class="nav-link" href="#" data-section="home" data-lang="nav_home">首頁</a></li>
                        <li class="nav-item" data-role='["user", "admin"]'><a class="nav-link" href="#" data-section="services" data-lang="nav_services">服務項目</a></li>
                        <li class="nav-item" data-role='["user", "doctor", "admin"]'><a class="nav-link" href="#" data-section="therapists" data-lang="nav_therapists">治療師</a></li>
                        <li class="nav-item" data-role='["user", "doctor", "admin"]'><a class="nav-link" href="#" data-section="booking" data-lang="nav_booking">線上預約</a></li>
                        <li class="nav-item" data-role='["user"]'><a class="nav-link" href="#" data-section="my-appointments-page" data-lang="nav_my_appointments">我的預約</a></li>
                        <li class="nav-item" data-role='["doctor", "admin"]'><a class="nav-link" href="#" data-section="doctor-dashboard" data-lang="nav_doctor_dashboard">病歷管理</a></li>
                        <li class="nav-item" data-role='["doctor", "admin"]'><a class="nav-link" href="#" data-section="clinical-system" data-lang="nav_clinical_system">臨床系統</a></li>
                        <li class="nav-item" data-role='["doctor", "admin"]'><a class="nav-link" href="#" data-section="my-schedule-page" data-lang="nav_my_schedule">我的排班</a></li>
                        <li class="nav-item" data-role='["admin"]'><a class="nav-link" href="#" data-section="admin-dashboard" data-lang="nav_admin_dashboard">後台管理</a></li>
                    </ul>
                    <div class="d-flex align-items-center">
                        <div id="auth-container" class="d-flex align-items-center">
                            <span id="user-welcome" class="nav-link hidden"></span>
                            <button id="login-btn" class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#login-modal" data-lang="login">登入</button>
                            <button id="register-btn" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#register-modal" data-lang="register">註冊</button>
                            <button id="logout-btn" class="btn btn-outline-secondary hidden" data-lang="logout">登出</button>
                        </div>
                        <div class="ms-3">
                            <select id="language-select" class="form-select form-select-sm">
                                <option value="zh-TW">繁體中文</option>
                                <option value="zh-CN">简体中文</option>
                                <option value="en">English</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Home Section -->
        <section id="home" class="active">
            <div class="container">
                <h1 class="display-4 fw-bold" data-lang="hero_title">專業、便捷的物理治療服務</h1>
                <p class="fs-4" data-lang="hero_subtitle">立即尋找適合您的治療師，開始您的康復之旅。</p>
                <button class="btn btn-primary btn-lg cta-button" data-section="booking" data-lang="hero_cta">立即預約</button>
            </div>
        </section>

        <!-- Services Section -->
        <section id="services" class="py-5 fade-in-section">
            <div class="container">
                <h2 class="text-center mb-5" data-lang="services_title">我們的服務</h2>
                <div id="service-cards" class="row g-4">
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm">
                            <img src="../assets/images/評估.png" class="card-img-top" alt="物理治療評估">
                            <div class="card-body d-flex flex-column">
                                <h3 class="card-title h5" data-lang="service1_title">物理治療評估</h3>
                                <p class="card-text" data-lang="service1_desc">全面的身體功能評估，找出問題根源。</p>
                                <div class="mt-auto d-flex justify-content-between align-items-center">
                                    <span class="text-primary fw-bold fs-5">NT$1,500</span>
                                    <span class="text-muted">60 min</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm">
                            <img src="../assets/images/徒手治療.png" class="card-img-top" alt="徒手治療">
                            <div class="card-body d-flex flex-column">
                                <h3 class="card-title h5" data-lang="service2_title">徒手治療</h3>
                                <p class="card-text" data-lang="service2_desc">透過專業手法，放鬆緊繃肌肉，改善關節活動度。</p>
                                <div class="mt-auto d-flex justify-content-between align-items-center">
                                    <span class="text-primary fw-bold fs-5">NT$1,200</span>
                                    <span class="text-muted">45 min</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm">
                            <img src="../assets/images/運動治療.png" class="card-img-top" alt="運動治療">
                            <div class="card-body d-flex flex-column">
                                <h3 class="card-title h5" data-lang="service3_title">運動治療</h3>
                                <p class="card-text" data-lang="service3_desc">設計個人化運動處方，強化肌力，預防復發。</p>
                                <div class="mt-auto d-flex justify-content-between align-items-center">
                                    <span class="text-primary fw-bold fs-5">NT$1,000</span>
                                    <span class="text-muted">45 min</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Therapists Section -->
        <section id="therapists" class="py-5 fade-in-section">
            <div class="container">
                <h2 class="text-center mb-5" data-lang="therapists_title">我們的治療師</h2>
                <div id="therapist-cards-container" class="row g-4">
                    <!-- Therapist cards will be generated by JS -->
                </div>
            </div>
        </section>

        <!-- Booking Section -->
        <section id="booking" class="py-5 fade-in-section">
            <div class="container">
                <h2 class="text-center mb-5" data-lang="booking_title">線上預約</h2>
                <div class="row g-5">
                    <div class="col-lg-7">
                        <div class="card shadow">
                            <div class="card-body">
                                <div class="calendar-header d-flex justify-content-between align-items-center mb-3">
                                    <button id="prev-month" class="btn btn-outline-primary"><i class="fas fa-chevron-left"></i></button>
                                    <h3 id="month-year" class="h4 mb-0"></h3>
                                    <button id="next-month" class="btn btn-outline-primary"><i class="fas fa-chevron-right"></i></button>
                                </div>
                                <div id="calendar-grid" class="calendar-grid"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <h3 class="h4" data-lang="available_slots">可預約時段</h3>
                        <div id="available-doctors-list" class="available-doctors-list">
                             <p class="text-muted">請先在左側選擇日期。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Doctor Dashboard Section -->
        <section id="doctor-dashboard" class="py-5 fade-in-section">
            <div class="container">
                <h2 class="text-center mb-5" data-lang="doctor_dashboard_title">病歷管理</h2>
                <div class="row g-4">
                    <div class="col-md-4">
                        <div class="card shadow-sm">
                            <div class="card-header"><h4 class="mb-0" data-lang="today_patients">今日病患</h4></div>
                            <div id="patient-list" class="list-group list-group-flush"></div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="card shadow-sm">
                            <div class="card-header"><h4 class="mb-0" data-lang="record_details">病歷詳情</h4></div>
                            <div id="record-details-content" class="card-body">
                                <p data-lang="select_patient_prompt">請從左側選擇一位病患以查看或編輯病歷。</p>
                                <form id="medical-record-form" class="hidden">
                                    <input type="hidden" id="medical-record-id">
                                    <input type="hidden" id="medical-record-patient-id">
                                    <div class="mb-3">
                                        <label for="record-diagnosis" class="form-label">診斷:</label>
                                        <input type="text" id="record-diagnosis" class="form-control" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="record-treatment" class="form-label">治療:</label>
                                        <textarea id="record-treatment" class="form-control" rows="5"></textarea>
                                    </div>
                                    <div class="mb-3">
                                        <label for="record-notes" class="form-label">備註:</label>
                                        <textarea id="record-notes" class="form-control" rows="5"></textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary">儲存病歷</button>
                                    <button type="button" id="new-medical-record-btn" class="btn btn-secondary">新增病歷</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Clinical System Section -->
        <section id="clinical-system" class="py-5 fade-in-section">
            <div class="container">
                <h2 class="text-center mb-5" data-lang="clinical_system_title">臨床輔助系統</h2>
                <div class="row g-4">
                    <div class="col-lg-7">
                        <div id="body-map-wrapper" class="shadow rounded">
                            <object id="body-map-svg" type="image/svg+xml" data="../assets/images/body-map.svg"></object>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <h3 class="h4" data-lang="select_body_part">選擇部位</h3>
                        <div id="body-part-menu" class="d-grid gap-2"></div>
                        <div id="acupuncture-info" class="mt-4"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Dashboard Section -->
        <section id="admin-dashboard" class="py-5 fade-in-section">
            <div class="container">
                <h2 class="text-center mb-5" data-lang="admin_dashboard_title">後台管理系統</h2>
                <div class="row g-4">
                    <div class="col-lg-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body">
                                <h3 class="card-title h5" data-lang="add_doctor_title">新增醫師</h3>
                                <form id="add-doctor-form">
                                    <div class="mb-3">
                                        <label for="doctor-user-id" class="form-label">選擇使用者：</label>
                                        <select id="doctor-user-id" class="form-select" required>
                                            <option value="">請選擇...</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="doctor-name" class="form-label" data-lang="doctor_name_label">醫師姓名：</label>
                                        <input type="text" id="doctor-name" class="form-control" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="doctor-specialty" class="form-label" data-lang="specialty_label">專長：</label>
                                        <input type="text" id="doctor-specialty" class="form-control" required>
                                    </div>
                                    <button type="submit" class="btn btn-primary" data-lang="add_button">新增</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body">
                                <h3 class="card-title h5" data-lang="schedule_management_title">排班管理</h3>
                                <div id="doctor-list" class="list-group"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card h-100 shadow-sm">
                            <div class="card-body">
                                <h3 class="card-title h5" data-lang="user_management_title">使用者管理</h3>
                                <div id="user-list-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- My Schedule Page -->
        <section id="my-schedule-page" class="py-5 fade-in-section">
            <div class="container">
                <h2 class="text-center mb-5" data-lang="nav_my_schedule">我的排班</h2>
                <div class="row g-5">
                    <div class="col-lg-7">
                        <div class="card shadow">
                            <div class="card-body">
                                <div class="calendar-header d-flex justify-content-between align-items-center mb-3">
                                    <button id="my-schedule-prev-month" class="btn btn-outline-primary"><i class="fas fa-chevron-left"></i></button>
                                    <h3 id="my-schedule-month-year" class="h4 mb-0"></h4>
                                    <button id="my-schedule-next-month" class="btn btn-outline-primary"><i class="fas fa-chevron-right"></i></button>
                                </div>
                                <div id="my-schedule-calendar-grid" class="calendar-grid"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-5">
                        <div class="time-slot-manager">
                            <div class="card shadow-sm mb-4">
                                <div class="card-header">
                                    <h4 class="h5 mb-0">個人化設定</h4>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="cancellation-hours-input" class="form-label">取消預約時限（小時）:</label>
                                        <div class="input-group">
                                            <input type="number" id="cancellation-hours-input" class="form-control" min="0">
                                            <button id="save-settings-btn" class="btn btn-outline-primary">儲存</button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <h3 class="h4" data-lang="manage_slots_title">管理可預約時段</h3>
                            <p><span data-lang="select_date_label">選擇日期:</span> <span id="my-schedule-selected-date-display" class="fw-bold text-primary"></span></p>
                            <div class="card shadow-sm">
                                <div class="card-body">
                                    <div class="add-time-range-form">
                                        <div class="row g-2 align-items-center">
                                            <div class="col">
                                                <input type="time" id="new-start-time-input" class="form-control">
                                            </div>
                                            <div class="col-auto">-</div>
                                            <div class="col">
                                                <input type="time" id="new-end-time-input" class="form-control">
                                            </div>
                                            <div class="col-auto">
                                                <button id="add-time-range-btn" class="btn btn-primary" data-lang="add_slot_button">新增</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div id="my-schedule-details-content" class="mt-4">
                                <p class="text-muted">請從左側選擇日期以新增或檢視排班。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- My Appointments Page -->
        <section id="my-appointments-page" class="py-5 fade-in-section">
            <div class="container">
                <h2 class="text-center mb-5" data-lang="nav_my_appointments">我的預約</h2>
                <div id="my-appointments-list" class="row g-4"></div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-4 mt-auto">
        <div class="container">
            <p class="mb-0" data-lang="footer_text">&copy; 2025 物理治療平台. All rights reserved.</p>
        </div>
    </footer>

    <!-- Login Modal -->
    <div class="modal fade" id="login-modal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel" data-lang="login_title">登入您的帳戶</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="login-form">
                        <div class="mb-3">
                            <label for="login-email" class="form-label">Email</label>
                            <input type="email" id="login-email" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="login-password" class="form-label" data-lang="password">密碼</label>
                            <input type="password" id="login-password" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100" data-lang="login">登入</button>
                    </form>
                    <hr>
                    <div id="gsi-container" class="d-flex justify-content-center"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal fade" id="register-modal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registerModalLabel" data-lang="register_title">建立新帳戶</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="register-form">
                        <div class="mb-3">
                            <label for="register-username" class="form-label" data-lang="username">使用者名稱</label>
                            <input type="text" id="register-username" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="register-email" class="form-label">Email</label>
                            <input type="email" id="register-email" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label for="register-password" class="form-label" data-lang="password">密碼</label>
                            <input type="password" id="register-password" class="form-control" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100" data-lang="register">註冊</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Schedule Modal (for Admin) -->
    <div class="modal fade" id="schedule-modal" tabindex="-1" aria-labelledby="scheduleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="schedule-modal-title">管理排班</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                     <div class="row g-5">
                        <div class="col-lg-7">
                            <div class="calendar-header d-flex justify-content-between align-items-center mb-3">
                                <button id="schedule-prev-month" class="btn btn-outline-primary"><i class="fas fa-chevron-left"></i></button>
                                <h3 id="schedule-month-year" class="h4 mb-0"></h3>
                                <button id="schedule-next-month" class="btn btn-outline-primary"><i class="fas fa-chevron-right"></i></button>
                            </div>
                            <div id="schedule-calendar-grid" class="calendar-grid"></div>
                        </div>
                        <div class="col-lg-5">
                            <h3 class="h4" data-lang="manage_slots_title">管理可預約時段</h3>
                            <p><span data-lang="select_date_label">選擇日期:</span> <span id="selected-date-display" class="fw-bold text-primary"></span></p>
                            <div class="add-time-slot-form input-group mb-3">
                                <input type="time" id="new-time-slot-input" class="form-control">
                                <button id="add-time-slot-btn" class="btn btn-primary" data-lang="add_slot_button">新增</button>
                            </div>
                            <div id="time-slots-list" class="list-group"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Patient Selection Modal -->
    <div class="modal fade" id="patient-selection-modal" tabindex="-1" aria-labelledby="patientSelectionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="patientSelectionModalLabel">為病患預約</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="patient-selection-modal-body">
                    <!-- Patient selection dropdown will be injected here by JS -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="confirm-patient-selection">確定</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Custom JS -->
    <script src="script.js"></script>
</body>
</html>
